<<<<<<< HEAD
/**
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 *
 * @format
 */
import { DEVICE_CONNECTIVITY_EVENT } from './privateTypes';
import { NetInfoCellularGeneration, NetInfoStateType } from './types'; // See https://wicg.github.io/netinfo/#dom-connectiontype

// Use a constant test of this form because in SSR on next.js, optional chaining is not sufficient,
// but this test correctly detects that window is not available and allows for conditionals before access
const isWindowPresent = typeof window !== 'undefined'; // Check if window exists and if the browser supports the connection API

const connection = isWindowPresent && !window.hasOwnProperty('tizen') && !window.hasOwnProperty('webOS') ? window.navigator.connection || window.navigator.mozConnection || window.navigator.webkitConnection : undefined; // Map browser types to native types

const typeMapping = {
  bluetooth: NetInfoStateType.bluetooth,
  cellular: NetInfoStateType.cellular,
  ethernet: NetInfoStateType.ethernet,
  none: NetInfoStateType.none,
  other: NetInfoStateType.other,
  unknown: NetInfoStateType.unknown,
  wifi: NetInfoStateType.wifi,
  wimax: NetInfoStateType.wimax,
  mixed: NetInfoStateType.other
};
const effectiveTypeMapping = {
  '2g': NetInfoCellularGeneration['2g'],
  '3g': NetInfoCellularGeneration['3g'],
  '4g': NetInfoCellularGeneration['4g'],
  'slow-2g': NetInfoCellularGeneration['2g']
}; // Determine current state of connection

const getCurrentState = _requestedInterface => {
  const isConnected = isWindowPresent ? navigator.onLine : false;
  const baseState = {
    isInternetReachable: null
  }; // If we don't have a connection object, we return minimal information

  if (!connection) {
    if (isConnected) {
      const state = { ...baseState,
        isConnected: true,
        type: NetInfoStateType.other,
        details: {
          isConnectionExpensive: false
        }
      };
      return state;
    }

    const state = { ...baseState,
      isConnected: false,
      isInternetReachable: false,
      type: NetInfoStateType.none,
      details: null
    };
    return state;
  } // Otherwise try to return detailed information


  const isConnectionExpensive = connection.saveData;
  const type = connection.type ? typeMapping[connection.type] : isConnected ? NetInfoStateType.other : NetInfoStateType.unknown;

  if (type === NetInfoStateType.bluetooth) {
    const state = { ...baseState,
      isConnected: true,
      type,
      details: {
        isConnectionExpensive
      }
    };
    return state;
  } else if (type === NetInfoStateType.cellular) {
    const state = { ...baseState,
      isConnected: true,
      type,
      details: {
        isConnectionExpensive,
        cellularGeneration: effectiveTypeMapping[connection.effectiveType] || null,
        carrier: null
      }
    };
    return state;
  } else if (type === NetInfoStateType.ethernet) {
    const state = { ...baseState,
      isConnected: true,
      type,
      details: {
        isConnectionExpensive,
        ipAddress: null,
        subnet: null
      }
    };
    return state;
  } else if (type === NetInfoStateType.wifi) {
    const state = { ...baseState,
      isConnected: true,
      type,
      details: {
        isConnectionExpensive,
        ssid: null,
        bssid: null,
        strength: null,
        ipAddress: null,
        subnet: null,
        frequency: null,
        linkSpeed: null,
        rxLinkSpeed: null,
        txLinkSpeed: null
      }
    };
    return state;
  } else if (type === NetInfoStateType.wimax) {
    const state = { ...baseState,
      isConnected: true,
      type,
      details: {
        isConnectionExpensive
      }
    };
    return state;
  } else if (type === NetInfoStateType.none) {
    const state = { ...baseState,
      isConnected: false,
      isInternetReachable: false,
      type,
      details: null
    };
    return state;
  } else if (type === NetInfoStateType.unknown) {
    const state = { ...baseState,
      isConnected,
      isInternetReachable: null,
      type,
      details: null
    };
    return state;
  }

  const state = { ...baseState,
    isConnected: true,
    type: NetInfoStateType.other,
    details: {
      isConnectionExpensive
    }
  };
  return state;
};

const handlers = [];
const nativeHandlers = [];
const RNCNetInfo = {
  addListener(type, handler) {
    switch (type) {
      case DEVICE_CONNECTIVITY_EVENT:
        {
          const nativeHandler = () => {
            handler(getCurrentState());
          };

          if (connection) {
            connection.addEventListener('change', nativeHandler);
          } else {
            if (isWindowPresent) {
              window.addEventListener('online', nativeHandler, false);
              window.addEventListener('offline', nativeHandler, false);
            }
          } // Remember handlers


          handlers.push(handler);
          nativeHandlers.push(nativeHandler);
          break;
        }
    }
  },

  removeListeners(type, handler) {
    switch (type) {
      case DEVICE_CONNECTIVITY_EVENT:
        {
          // Get native handler
          const index = handlers.indexOf(handler);
          const nativeHandler = nativeHandlers[index];

          if (connection) {
            connection.removeEventListener('change', nativeHandler);
          } else {
            if (isWindowPresent) {
              window.removeEventListener('online', nativeHandler);
              window.removeEventListener('offline', nativeHandler);
            }
          } // Remove handlers


          handlers.splice(index, 1);
          nativeHandlers.splice(index, 1);
          break;
        }
    }
  },

  async getCurrentState(requestedInterface) {
    return getCurrentState(requestedInterface);
  },

  configure() {
    return;
  }

};
export default RNCNetInfo;
=======
import _regeneratorRuntime from"@babel/runtime/regenerator";import _objectSpread from"@babel/runtime/helpers/objectSpread";import{DEVICE_CONNECTIVITY_EVENT}from'./privateTypes';import{NetInfoStateType,NetInfoCellularGeneration}from'./types';var connection=window.navigator.connection||window.navigator.mozConnection||window.navigator.webkitConnection;var typeMapping={bluetooth:NetInfoStateType.bluetooth,cellular:NetInfoStateType.cellular,ethernet:NetInfoStateType.ethernet,none:NetInfoStateType.none,other:NetInfoStateType.other,unknown:NetInfoStateType.unknown,wifi:NetInfoStateType.wifi,wimax:NetInfoStateType.wimax,mixed:NetInfoStateType.other};var effectiveTypeMapping={'2g':NetInfoCellularGeneration['2g'],'3g':NetInfoCellularGeneration['3g'],'4g':NetInfoCellularGeneration['4g'],'slow-2g':NetInfoCellularGeneration['2g']};var _getCurrentState=function getCurrentState(_requestedInterface){var isConnected=navigator.onLine;var baseState={isInternetReachable:null};if(!connection){if(isConnected){var _state2=_objectSpread({},baseState,{isConnected:true,type:NetInfoStateType.other,details:{isConnectionExpensive:false}});return _state2;}var _state=_objectSpread({},baseState,{isConnected:false,isInternetReachable:false,type:NetInfoStateType.none,details:null});return _state;}var isConnectionExpensive=connection.saveData;var type=connection.type?typeMapping[connection.type]:isConnected?NetInfoStateType.other:NetInfoStateType.unknown;if(type===NetInfoStateType.bluetooth){var _state3=_objectSpread({},baseState,{isConnected:true,type:type,details:{isConnectionExpensive:isConnectionExpensive}});return _state3;}else if(type===NetInfoStateType.cellular){var _state4=_objectSpread({},baseState,{isConnected:true,type:type,details:{isConnectionExpensive:isConnectionExpensive,cellularGeneration:effectiveTypeMapping[connection.effectiveType]||null,carrier:null}});return _state4;}else if(type===NetInfoStateType.ethernet){var _state5=_objectSpread({},baseState,{isConnected:true,type:type,details:{isConnectionExpensive:isConnectionExpensive,ipAddress:null,subnet:null}});return _state5;}else if(type===NetInfoStateType.wifi){var _state6=_objectSpread({},baseState,{isConnected:true,type:type,details:{isConnectionExpensive:isConnectionExpensive,ssid:null,bssid:null,strength:null,ipAddress:null,subnet:null,frequency:null}});return _state6;}else if(type===NetInfoStateType.wimax){var _state7=_objectSpread({},baseState,{isConnected:true,type:type,details:{isConnectionExpensive:isConnectionExpensive}});return _state7;}else if(type===NetInfoStateType.none){var _state8=_objectSpread({},baseState,{isConnected:false,isInternetReachable:false,type:type,details:null});return _state8;}else if(type===NetInfoStateType.unknown){var _state9=_objectSpread({},baseState,{isConnected:false,isInternetReachable:false,type:type,details:null});return _state9;}var state=_objectSpread({},baseState,{isConnected:true,type:NetInfoStateType.other,details:{isConnectionExpensive:isConnectionExpensive}});return state;};var handlers=[];var nativeHandlers=[];var RNCNetInfo={addListener:function addListener(type,handler){switch(type){case DEVICE_CONNECTIVITY_EVENT:{var nativeHandler=function nativeHandler(){handler(_getCurrentState());};if(connection){connection.addEventListener('change',nativeHandler);}else{window.addEventListener('online',nativeHandler,false);window.addEventListener('offline',nativeHandler,false);}handlers.push(handler);nativeHandlers.push(nativeHandler);break;}}},removeListeners:function removeListeners(type,handler){switch(type){case DEVICE_CONNECTIVITY_EVENT:{var index=handlers.indexOf(handler);var nativeHandler=nativeHandlers[index];if(connection){connection.removeEventListener('change',nativeHandler);}else{window.addEventListener('online',nativeHandler);window.addEventListener('offline',nativeHandler);}handlers.splice(index,1);nativeHandlers.splice(index,1);break;}}},getCurrentState:function getCurrentState(requestedInterface){return _regeneratorRuntime.async(function getCurrentState$(_context){while(1){switch(_context.prev=_context.next){case 0:return _context.abrupt("return",_getCurrentState(requestedInterface));case 1:case"end":return _context.stop();}}},null,this);}};export default RNCNetInfo;
>>>>>>> aec85746435d3ba41358c5b7d65f93f87448e5b8
//# sourceMappingURL=nativeModule.web.js.map